From 69ce8c1a02cf1b572a5b9837af7c05c5fc16714a Mon Sep 17 00:00:00 2001
From: Garrett Brown <garrett.brown@aclima.earth>
Date: Sun, 16 Nov 2025 12:19:37 -0800
Subject: [PATCH 2/2] Use sensor data QoS

---
 image_transport/src/image_transport.cpp | 24 ++++++++++++------------
 1 file changed, 12 insertions(+), 12 deletions(-)

diff --git a/image_transport/src/image_transport.cpp b/image_transport/src/image_transport.cpp
index 67c3039..14364cd 100644
--- a/image_transport/src/image_transport.cpp
+++ b/image_transport/src/image_transport.cpp
@@ -143,9 +143,9 @@ Publisher ImageTransport::advertise(const std::string & base_topic, uint32_t que
 {
   // TODO(ros2) implement when resolved: https://github.com/ros2/ros2/issues/464
   (void) latch;
-  rmw_qos_profile_t custom_qos = rmw_qos_profile_default;
-  custom_qos.depth = queue_size;
-  return create_publisher(impl_->node_.get(), base_topic, custom_qos);
+  rclcpp::QoS sensor_qos = rclcpp::SensorDataQoS();
+  sensor_qos.keep_last(queue_size);
+  return create_publisher(impl_->node_.get(), base_topic, sensor_qos.get_rmw_qos_profile());
 }
 
 Publisher ImageTransport::advertise(
@@ -179,11 +179,11 @@ Subscriber ImageTransport::subscribe(
   const rclcpp::SubscriptionOptions options)
 {
   (void) tracked_object;
-  rmw_qos_profile_t custom_qos = rmw_qos_profile_default;
-  custom_qos.depth = queue_size;
+  rclcpp::QoS sensor_qos = rclcpp::SensorDataQoS();
+  sensor_qos.keep_last(queue_size);
   return create_subscription(
     impl_->node_.get(), base_topic, callback,
-    getTransportOrDefault(transport_hints), custom_qos,
+    getTransportOrDefault(transport_hints), sensor_qos.get_rmw_qos_profile(),
     options);
 }
 
@@ -193,9 +193,9 @@ CameraPublisher ImageTransport::advertiseCamera(
 {
   // TODO(ros2) implement when resolved: https://github.com/ros2/ros2/issues/464
   (void) latch;
-  rmw_qos_profile_t custom_qos = rmw_qos_profile_default;
-  custom_qos.depth = queue_size;
-  return create_camera_publisher(impl_->node_.get(), base_topic, custom_qos);
+  rclcpp::QoS sensor_qos = rclcpp::SensorDataQoS();
+  sensor_qos.keep_last(queue_size);
+  return create_camera_publisher(impl_->node_.get(), base_topic, sensor_qos.get_rmw_qos_profile());
 }
 
 CameraSubscriber ImageTransport::subscribeCamera(
@@ -205,11 +205,11 @@ CameraSubscriber ImageTransport::subscribeCamera(
   const TransportHints * transport_hints)
 {
   (void) tracked_object;
-  rmw_qos_profile_t custom_qos = rmw_qos_profile_default;
-  custom_qos.depth = queue_size;
+  rclcpp::QoS sensor_qos = rclcpp::SensorDataQoS();
+  sensor_qos.keep_last(queue_size);
   return create_camera_subscription(
     impl_->node_.get(), base_topic, callback,
-    getTransportOrDefault(transport_hints), custom_qos);
+    getTransportOrDefault(transport_hints), sensor_qos.get_rmw_qos_profile());
 }
 
 std::vector<std::string> ImageTransport::getDeclaredTransports() const
-- 
2.43.0

