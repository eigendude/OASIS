From 0db2dbd117351389d86d4a5195da72e166c09839 Mon Sep 17 00:00:00 2001
From: Ivan Santiago Paunovic <ivanpauno@ekumenlabs.com>
Date: Wed, 10 Aug 2022 15:18:19 -0300
Subject: [PATCH 2/4] Fix compressed_depth_publisher

Signed-off-by: Ivan Santiago Paunovic <ivanpauno@ekumenlabs.com>
---
 .../compressed_depth_publisher.h                           | 7 ++++---
 .../src/compressed_depth_publisher.cpp                     | 5 +++--
 2 files changed, 7 insertions(+), 5 deletions(-)

diff --git a/compressed_depth_image_transport/include/compressed_depth_image_transport/compressed_depth_publisher.h b/compressed_depth_image_transport/include/compressed_depth_image_transport/compressed_depth_publisher.h
index d67af74..09c0498 100644
--- a/compressed_depth_image_transport/include/compressed_depth_image_transport/compressed_depth_publisher.h
+++ b/compressed_depth_image_transport/include/compressed_depth_image_transport/compressed_depth_publisher.h
@@ -50,12 +50,13 @@ public:
 
 protected:
   // Overridden to set up reconfigure server
-  virtual void advertiseImpl(
+  void advertiseImpl(
           rclcpp::Node * node,
           const std::string &base_topic,
-          rmw_qos_profile_t custom_qos) override final;
+          rmw_qos_profile_t custom_qos,
+          rclcpp::PublisherOptions options) override final;
 
-  virtual void publish(const sensor_msgs::msg::Image& message,
+  void publish(const sensor_msgs::msg::Image& message,
                        const PublishFn& publish_fn) const override final;
 
   struct Config {
diff --git a/compressed_depth_image_transport/src/compressed_depth_publisher.cpp b/compressed_depth_image_transport/src/compressed_depth_publisher.cpp
index aca3741..4eb4678 100644
--- a/compressed_depth_image_transport/src/compressed_depth_publisher.cpp
+++ b/compressed_depth_image_transport/src/compressed_depth_publisher.cpp
@@ -60,10 +60,11 @@ namespace compressed_depth_image_transport
 void CompressedDepthPublisher::advertiseImpl(
   rclcpp::Node * node,
   const std::string& base_topic,
-  rmw_qos_profile_t custom_qos)
+  rmw_qos_profile_t custom_qos,
+  rclcpp::PublisherOptions options)
 {
   typedef image_transport::SimplePublisherPlugin<sensor_msgs::msg::CompressedImage> Base;
-  Base::advertiseImpl(node, base_topic, custom_qos);
+  Base::advertiseImpl(node, base_topic, custom_qos, options);
 
   node->get_parameter_or<int>("png_level", config_.png_level, kDefaultPngLevel);
   node->get_parameter_or<double>("depth_max", config_.depth_max, kDefaultDepthMax);
-- 
2.34.1

